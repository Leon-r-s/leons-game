<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8" />
    <title>„É™„Éº„É™„Éº„ÅÆ„É™„É≥„Ç¥Êãæ„ÅÑ„Ç≤„Éº„É†üçé</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #a8d0e6;
            font-family: sans-serif;
        }
        #gameArea {
            position: relative;
            width: 800px;
            height: 600px;
            margin: 20px auto;
            background: url('background.png') no-repeat center/cover;
            border: 4px solid #555;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
            touch-action: none; /* „Çø„ÉÉ„ÉÅÂãï‰Ωú„ÇíË®±ÂèØ */
        }
        #basket {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 80px;
            background: url('leelee.png') no-repeat center/contain;
        }
        .apple {
            position: absolute;
            top: 0;
            width: 40px;
            height: 40px;
            background: url('apple.png') no-repeat center/contain;
        }
        #score {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 24px;
            color: #333;
        }
        #timer {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 24px;
            color: #333;
        }
        #clearMessage {
            position: absolute;
            top: 40%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 36px;
            color: #ff5555;
            display: none;
            text-align: center;
        }
        #restartButton {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 18px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="gameArea">
        <div id="basket"></div>
        <div id="score">üçé 0</div>
        <div id="timer">‚è≥ 30</div>
        <div id="clearMessage">
            üéâ „Çø„Ç§„É†„Ç¢„ÉÉ„ÉóÔºÅ<br>
            „Çπ„Ç≥„Ç¢Ôºöüçé <span id="finalScore">0</span><br>
            <button id="restartButton">„ÇÇ„ÅÜ1Âõû„ÅÇ„Åù„Å∂</button>
        </div>
    </div>
    <script>
        const basket = document.getElementById('basket');
        const gameArea = document.getElementById('gameArea');
        const scoreDisplay = document.getElementById('score');
        const timerDisplay = document.getElementById('timer');
        const clearMessage = document.getElementById('clearMessage');
        const finalScoreDisplay = document.getElementById('finalScore');
        const restartButton = document.getElementById('restartButton');

        let score = 0;
        let isGameOver = false;
        let timeLeft = 30;
        let dropSpeed = 5;
        let appleDropInterval;
        let timerInterval;

        let moveInterval = null; // ‚Üê „Çπ„Éû„ÉõÈÄ£Á∂öÁßªÂãïÁî®

        function startGame() {
            score = 0;
            timeLeft = 30;
            dropSpeed = 5;
            isGameOver = false;
            scoreDisplay.textContent = `üçé ${score}`;
            timerDisplay.textContent = `‚è≥ ${timeLeft}`;
            clearMessage.style.display = 'none';
            basket.style.left = '50%';
            appleDropInterval = setInterval(dropApple, 1500);
            timerInterval = setInterval(updateTimer, 1000);
        }

        function updateTimer() {
            timeLeft--;
            timerDisplay.textContent = `‚è≥ ${timeLeft}`;
            if (timeLeft === 20) dropSpeed = 7;
            if (timeLeft === 10) dropSpeed = 10;
            if (timeLeft <= 0) {
                gameOver();
            }
        }

        function gameOver() {
            isGameOver = true;
            clearInterval(appleDropInterval);
            clearInterval(timerInterval);
            finalScoreDisplay.textContent = score;
            clearMessage.style.display = 'block';
        }

        // PCÁî®„Ç≠„Éº„Éú„Éº„ÉâÊìç‰Ωú
        document.addEventListener('keydown', (e) => {
            if (isGameOver) return;
            const left = parseInt(window.getComputedStyle(basket).left);
            if (e.key === 'ArrowLeft' && left > 0) {
                basket.style.left = (left - 20) + 'px';
            } else if (e.key === 'ArrowRight' && left < (gameArea.offsetWidth - basket.offsetWidth)) {
                basket.style.left = (left + 20) + 'px';
            }
        });

        // „Çπ„Éû„Éõ„Çø„ÉÉ„ÉóÈÄ£Á∂öÁßªÂãï
        gameArea.addEventListener('touchstart', (e) => {
            if (isGameOver) return;
            const touchX = e.touches[0].clientX;
            const gameAreaRect = gameArea.getBoundingClientRect();
            const middleX = gameAreaRect.left + gameAreaRect.width / 2;

            const direction = (touchX < middleX) ? -1 : 1;

            moveInterval = setInterval(() => {
                const left = parseInt(window.getComputedStyle(basket).left);
                if (direction === -1 && left > 0) {
                    basket.style.left = (left - 10) + 'px';
                } else if (direction === 1 && left < (gameArea.offsetWidth - basket.offsetWidth)) {
                    basket.style.left = (left + 10) + 'px';
                }
            }, 20);
        });

        gameArea.addEventListener('touchend', () => {
            clearInterval(moveInterval);
        });

        function dropApple() {
            if (isGameOver) return;
            const apple = document.createElement('div');
            apple.className = 'apple';
            apple.style.left = Math.random() * (gameArea.offsetWidth - 40) + 'px';
            gameArea.appendChild(apple);

            let appleTop = 0;
            const fall = setInterval(() => {
                if (isGameOver) {
                    clearInterval(fall);
                    apple.remove();
                    return;
                }

                appleTop += dropSpeed;
                apple.style.top = appleTop + 'px';

                const basketRect = basket.getBoundingClientRect();
                const appleRect = apple.getBoundingClientRect();

                if (
                    appleRect.bottom >= basketRect.top &&
                    appleRect.left < basketRect.right &&
                    appleRect.right > basketRect.left
                ) {
                    clearInterval(fall);
                    apple.remove();
                    score++;
                    scoreDisplay.textContent = `üçé ${score}`;
                }

                if (appleTop > gameArea.offsetHeight) {
                    clearInterval(fall);
                    apple.remove();
                    score = Math.max(0, score - 1);
                    scoreDisplay.textContent = `üçé ${score}`;
                }
            }, 20);
        }

        restartButton.addEventListener('click', startGame);

        startGame();
    </script>
</body>
</html>
